<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Patient Concierge AI ‚Äì Implant Leads</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e6edf6;
      --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);

      --bot:#eef2ff;
      --user:#eafff2;

      --accent:#0ea5e9;
      --accent2:#22c55e;
      --danger:#ef4444;
      --btn:#0f172a;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; padding:0;
      font-family: Arial, sans-serif;
      background: radial-gradient(1000px 600px at 20% 10%, #eaf3ff 0%, transparent 55%),
                  radial-gradient(900px 500px at 90% 20%, #e7fff1 0%, transparent 50%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{ max-width:820px; margin:0 auto; padding:22px; }
    .shell{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .top{
      padding:18px 18px 12px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .mark{
      width:44px; height:44px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--accent), #0b3b76);
      box-shadow: 0 10px 20px rgba(14,165,233,0.25);
      display:flex; align-items:center; justify-content:center;
      color:#fff;
      font-weight:800;
      letter-spacing:0.5px;
    }
    .titleBlock h1{
      margin:0;
      font-size:16px;
      line-height:1.2;
    }
    .titleBlock p{
      margin:6px 0 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
      max-width:560px;
    }
    .tag{
      margin-top:2px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:#0b3b76;
      background:#eaf6ff;
      border:1px solid #d8efff;
      padding:8px 10px;
      border-radius:999px;
      white-space:nowrap;
    }
    .dot{
      width:8px; height:8px;
      border-radius:999px;
      background:var(--accent2);
      box-shadow:0 0 0 4px rgba(34,197,94,0.15);
    }

    .clinicCard{
      margin:14px 18px 0 18px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 14px;
      background:#f8fbff;
      display:flex;
      gap:12px;
      justify-content:space-between;
      flex-wrap:wrap;
      align-items:center;
    }
    .clinicLeft{ display:flex; flex-direction:column; gap:4px; }
    .clinicName{ font-weight:800; font-size:13px; }
    .clinicMeta{ font-size:12px; color:var(--muted); }
    .privacy{
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:8px;
      align-items:center;
    }
    .shield{
      width:18px; height:18px;
      border-radius:6px;
      background:#e7fff1;
      border:1px solid #c9f6da;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
    }

    .main{ padding:14px 18px 18px 18px; }
    .chat{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:8px 0 10px 0;
      min-height:270px;
    }
    .msg{
      max-width:86%;
      padding:12px 14px;
      border-radius:14px;
      line-height:1.25;
      font-size:14px;
      white-space:pre-wrap;
    }
    .bot{
      background:var(--bot);
      align-self:flex-start;
      border:1px solid #e3e7ff;
    }
    .user{
      background:var(--user);
      align-self:flex-end;
      border:1px solid #c9f6da;
    }
    .controls{ margin-top:6px; }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; }

    button{
      border:0;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      background:var(--btn);
      color:white;
      font-size:14px;
    }
    button.secondary{
      background:#fff;
      color:var(--text);
      border:1px solid var(--line);
    }
    button.success{ background:var(--accent2); }
    button.warn{ background:var(--danger); }

    input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus{
      border-color:#b7dcf4;
      box-shadow: 0 0 0 4px rgba(14,165,233,0.12);
    }

    .fineprint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
      border-top:1px solid var(--line);
      padding-top:10px;
    }
    .successBox{
      border:1px solid #c9f6da;
      background:#eafff2;
      border-radius:14px;
      padding:14px;
      margin-top:10px;
      color:#064e3b;
      font-size:13px;
      line-height:1.45;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="shell">
      <div class="top">
        <div class="brand">
          <div class="mark">PC</div>
          <div class="titleBlock">
            <h1>Patient Concierge AI ‚Äì Implant Leads</h1>
            <p id="subtitle">
              A clinic-grade assistant that gathers the key implant consultation details in under 60 seconds,
              then submits them securely so the clinic can call and confirm.
            </p>
          </div>
        </div>
        <div class="tag"><span class="dot"></span> 24/7 Intake Assistant</div>
      </div>

      <div class="clinicCard">
        <div class="clinicLeft">
          <div class="clinicName" id="clinicName">Demo Dental Clinic</div>
          <div class="clinicMeta" id="clinicMeta">Implant consultations ‚Ä¢ Nairobi</div>
        </div>
        <div class="privacy">
          <span class="shield">üîí</span>
          <span>Private & confidential. For consultation requests only.</span>
        </div>
      </div>

      <div class="main">
        <div id="chat" class="chat"></div>
        <div id="controls" class="controls"></div>

        <div class="fineprint">
          Final suitability and exact pricing are confirmed during an in-person clinical examination.
          If you have severe pain, swelling, fever, or bleeding, contact the clinic immediately.
        </div>
      </div>
    </div>
  </div>

<script>
  // ----------------- DEMO MODE -----------------
  // Demo link:  https://maweofc-del.github.io/patient-concierge-ai/?demo=1
  // Normal:     https://maweofc-del.github.io/patient-concierge-ai/
  const params = new URLSearchParams(window.location.search);
  const DEMO_MODE = params.get("demo") === "1";

  // ----------------- CLINIC BRANDING -----------------
  const CLINIC = {
    name: "Demo Dental Clinic",
    meta: "Implant consultations ‚Ä¢ Nairobi",
    urgentWhatsApp: "" // example: "+2547XXXXXXXX". Leave empty to hide urgent button.
  };
  document.getElementById("clinicName").textContent = CLINIC.name;
  document.getElementById("clinicMeta").textContent = CLINIC.meta;

  if (DEMO_MODE) {
    document.getElementById("subtitle").textContent =
      "Demo mode: enter your email to receive the lead summary after submission, then try the chatbot like a patient.";
  }

  // ----------------- GOOGLE FORM CONFIG (auto-submits to Sheets) -----------------
  const FORM_LINK = "https://docs.google.com/forms/d/e/1FAIpQLSdDmAFe3cRn7yZIKJRILYZPoP0nJyNtQ4jZFfOt64UcqKfK7w/viewform";
  const FORM_RESPONSE_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdDmAFe3cRn7yZIKJRILYZPoP0nJyNtQ4jZFfOt64UcqKfK7w/formResponse";

  const ENTRY = {
    name: "entry.98128128",
    phone: "entry.1541422852",
    email: "entry.1254364814",
    interest: "entry.1614899485",
    missingDuration: "entry.458020986",
    pain: "entry.389541324",
    timeline: "entry.539871036",
    prefTime: "entry.156682484",
    notes: "entry.1367604722"
  };

  // ----------------- APPS SCRIPT MAILER (for demo proof) -----------------
  const MAILER_URL = "https://script.google.com/macros/s/AKfycbwobfSvAaRJi7XKOekFQf5a7uVDIFaYwdsFkHnEsn35sQNFWgsZQtzwqNJAaGNxRcEE/exec";

  // ----------------- UI HELPERS -----------------
  const chat = document.getElementById("chat");
  const controls = document.getElementById("controls");

  const state = {
    demoEmail: null, // only used in demo mode
    interest: null,
    missingDuration: null,
    pain: null,
    timeline: null,
    prefTime: null,
    name: null,
    phone: null,
    email: null
  };

  function addMsg(text, who="bot") {
    const div = document.createElement("div");
    div.className = `msg ${who}`;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  function setButtons(options, onPick) {
    controls.innerHTML = "";
    const wrap = document.createElement("div");
    wrap.className = "actions";
    options.forEach(opt => {
      const b = document.createElement("button");
      b.className = opt.className || "";
      b.textContent = opt.label;
      b.onclick = () => onPick(opt.value);
      wrap.appendChild(b);
    });
    controls.appendChild(wrap);
  }

  function setInput(placeholder, onSubmit) {
    controls.innerHTML = "";
    const input = document.createElement("input");
    input.placeholder = placeholder;
    input.autocomplete = "off";

    const wrap = document.createElement("div");
    wrap.className = "actions";

    const btn = document.createElement("button");
    btn.textContent = "Send";

    btn.onclick = () => {
      const v = input.value.trim();
      if (!v) return;
      onSubmit(v);
    };

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btn.click();
    });

    wrap.appendChild(input);
    wrap.appendChild(btn);
    controls.appendChild(wrap);
    input.focus();
  }

  function isEmailLike(v){
    return v.includes("@") && v.includes(".");
  }

  // ----------------- DEMO EMAIL STEP -----------------
  function demoAskEmail() {
    addMsg("üëã Demo mode: What email should receive the lead summary after submission?");
    setInput("Type your email‚Ä¶", (v) => {
      if (!isEmailLike(v)) {
        addMsg("That doesn‚Äôt look like an email. Please type a valid email (example: clinic@gmail.com).");
        demoAskEmail();
        return;
      }
      state.demoEmail = v;
      addMsg(v, "user");
      addMsg("Great ‚úÖ Now try the chatbot like a patient to see the full lead workflow.");
      startPatientFlow();
    });
  }

  // ----------------- CONVERSATION FLOW -----------------
  function startPatientFlow() {
    addMsg("Hi üëã I‚Äôm the clinic‚Äôs intake assistant. I‚Äôll help you request an implant consultation.");
    addMsg("Is this for one missing tooth or more?");

    setButtons([
      { label: "One tooth implant", value: "One tooth implant" },
      { label: "Multiple teeth implants", value: "Multiple teeth implants" },
      { label: "Full mouth implants / dentures", value: "Full mouth implants / dentures" }
    ], (v) => {
      state.interest = v;
      addMsg(v, "user");
      stepDuration();
    });
  }

  function stepDuration() {
    addMsg("How long have the teeth been missing?");
    setButtons([
      { label: "Under 3 months", value: "Under 3 months" },
      { label: "3‚Äì12 months", value: "3‚Äì12 months" },
      { label: "1+ years", value: "1+ years" }
    ], (v) => {
      state.missingDuration = v;
      addMsg(v, "user");
      stepPain();
    });
  }

  function stepPain() {
    addMsg("Are you currently experiencing pain or swelling?");
    setButtons([
      { label: "Yes", value: "Yes" },
      { label: "No", value: "No" },
      { label: "Not sure", value: "Not sure" }
    ], (v) => {
      state.pain = v;
      addMsg(v, "user");
      stepTimeline();
    });
  }

  function stepTimeline() {
    addMsg("When would you like your consultation?");
    setButtons([
      { label: "ASAP", value: "ASAP" },
      { label: "This week", value: "This week" },
      { label: "Next week", value: "Next week" },
      { label: "Not sure yet", value: "Not sure yet" }
    ], (v) => {
      state.timeline = v;
      addMsg(v, "user");
      stepPrefTime();
    });
  }

  function stepPrefTime() {
    addMsg("Preferred appointment time?");
    setButtons([
      { label: "Morning", value: "Morning" },
      { label: "Afternoon", value: "Afternoon" },
      { label: "Evening", value: "Evening" }
    ], (v) => {
      state.prefTime = v;
      addMsg(v, "user");
      stepName();
    });
  }

  function stepName() {
    addMsg("Great ‚úÖ What‚Äôs your full name?");
    setInput("Type your name‚Ä¶", (v) => {
      state.name = v;
      addMsg(v, "user");
      stepPhone();
    });
  }

  function stepPhone() {
    addMsg("What‚Äôs the best phone/WhatsApp number to confirm your consultation?");
    setInput("Type your phone number‚Ä¶", (v) => {
      state.phone = v;
      addMsg(v, "user");
      stepEmail();
    });
  }

  function stepEmail() {
    addMsg("Optional: your email (for confirmation). You can type 'skip' to continue.");
    setInput("Type your email or 'skip'‚Ä¶", (v) => {
      if (v.toLowerCase() !== "skip") state.email = v;
      addMsg(v, "user");
      finish();
    });
  }

  // ----------------- SUBMISSIONS -----------------
  async function submitToGoogleForm() {
    const payload = new URLSearchParams();
    payload.append(ENTRY.name, state.name || "");
    payload.append(ENTRY.phone, state.phone || "");
    payload.append(ENTRY.email, state.email || "");
    payload.append(ENTRY.interest, state.interest || "");
    payload.append(ENTRY.missingDuration, state.missingDuration || "");
    payload.append(ENTRY.pain, state.pain || "");
    payload.append(ENTRY.timeline, state.timeline || "");
    payload.append(ENTRY.prefTime, state.prefTime || "");
    payload.append(ENTRY.notes, "Submitted via Patient Concierge AI");

    await fetch(FORM_RESPONSE_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: payload.toString()
    });
  }

  async function sendDemoEmailIfNeeded() {
    if (!DEMO_MODE || !state.demoEmail) return;

    const payload = {
      toEmail: state.demoEmail,
      subject: `New Implant Lead ‚úÖ (${CLINIC.name})`,
      clinic: CLINIC.name,
      name: state.name,
      phone: state.phone,
      email: state.email || "",
      interest: state.interest,
      missingDuration: state.missingDuration,
      pain: state.pain,
      timeline: state.timeline,
      prefTime: state.prefTime
    };

    // IMPORTANT: Use text/plain to avoid browser preflight/CORS issues.
    await fetch(MAILER_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    });
  }

  function finish() {
    addMsg("Perfect ‚úÖ Thanks! Please review your details and submit your request.");

    const summary =
`Consultation request summary:
‚Ä¢ Interest: ${state.interest}
‚Ä¢ Missing for: ${state.missingDuration}
‚Ä¢ Pain/swelling: ${state.pain}
‚Ä¢ Timeline: ${state.timeline}
‚Ä¢ Preferred time: ${state.prefTime}
‚Ä¢ Name: ${state.name}
‚Ä¢ Phone: ${state.phone}
‚Ä¢ Email: ${state.email || "‚Äî"}`;

    addMsg(summary, "bot");

    const buttons = [
      { label: "Submit Request", value: "submit", className: "success" },
      { label: "Open Form (Backup)", value: "open", className: "secondary" }
    ];

    if (CLINIC.urgentWhatsApp && CLINIC.urgentWhatsApp.trim().length > 0) {
      buttons.push({ label: "Urgent? WhatsApp Clinic", value: "wa", className: "warn" });
    }

    setButtons(buttons, async (v) => {
      if (v === "open") {
        window.open(FORM_LINK, "_blank");
        return;
      }

      if (v === "wa") {
        const num = CLINIC.urgentWhatsApp.replace(/\s+/g, "");
        const msg = encodeURIComponent("Hi, I submitted an implant consultation request. Could someone assist me?");
        window.open(`https://wa.me/${num.replace("+","")}?text=${msg}`, "_blank");
        return;
      }

      addMsg("Submitting‚Ä¶ ‚úÖ", "bot");

      try {
        // 1) save to Sheets (Google Form)
        await submitToGoogleForm();

        // 2) demo proof email to the demoer
        await sendDemoEmailIfNeeded();

        controls.innerHTML = "";
        const success = document.createElement("div");
        success.className = "successBox";

        const extra = (DEMO_MODE && state.demoEmail)
          ? ("<br/><br/><b>Demo:</b> A lead summary was sent to <b>" + state.demoEmail + "</b>. Check your inbox (and Spam).")
          : "";

        success.innerHTML =
          "<b>‚úÖ Request received.</b><br/>" +
          "Thank you. The clinic team will contact you shortly to confirm your consultation." +
          extra +
          "<br/><br/><span style='color:#065f46'>Tip:</span> Please keep your phone available for a call or WhatsApp message.";

        controls.appendChild(success);

      } catch (err) {
        addMsg("‚ö†Ô∏è Something went wrong submitting your request. Please tap 'Open Form (Backup)' to submit.", "bot");
      }
    });
  }

  // ----------------- START -----------------
  if (DEMO_MODE) demoAskEmail();
  else startPatientFlow();
</script>
</body>
</html>
