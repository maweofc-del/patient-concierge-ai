<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patient Concierge AI ‚Äî Dental Booking</title>
  <meta name="description" content="A 24/7 dental booking concierge that captures patient details and emails the clinic instantly." />
  <style>
    :root{
  --bg:#f7fbff;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#475569;

  --brand:#2563eb;
  --brand2:#0ea5e9;
  --ok:#16a34a;

  --border:rgba(15,23,42,.10);
  --shadow:0 18px 55px rgba(2,6,23,.10);
  --radius:18px;

  /* chat bubbles */
  --botBubble: rgba(37,99,235,.08);
  --userBubble: rgba(22,163,74,.10);
}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 650px at 25% 10%, rgba(56,189,248,.18), transparent 60%),
        radial-gradient(900px 650px at 80% 10%, rgba(34,197,94,.14), transparent 60%),
        linear-gradient(180deg,#070b14,#0b1220);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .shell{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width:900px){ .shell{grid-template-columns:1fr} }
    .panel{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .head{
      padding:16px 16px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .logo{
      width:36px;height:36px;border-radius:12px;
      display:grid;place-items:center;
      background:linear-gradient(135deg,#2563eb,#38bdf8);
      color:#fff;font-weight:1000;
    }
    .pill{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:rgba(15,23,42,.45);
    }
    .subhead{
      padding:14px 16px;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    .chat{
      height:520px;
      padding:16px;
      overflow:auto;
    }
    .row{display:flex; margin:10px 0}
    .bot{justify-content:flex-start}
    .you{justify-content:flex-end}
    .bubble{
      max-width:82%;
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      line-height:1.35;
      border:1px solid var(--border);
    }
    .bubble.bot{
      background:rgba(59,130,246,.10);
    }
    .bubble.you{
      background:rgba(34,197,94,.12);
    }
    .choices{
      display:flex;flex-wrap:wrap;gap:8px;margin-top:10px
    }
    .choice{
      background:rgba(255,255,255,.04);
      border:1px solid var(--border);
      color:var(--text);
      padding:10px 10px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      transition:transform .08s ease, filter .2s ease;
    }
    .choice:hover{transform:translateY(-1px);filter:brightness(1.03)}
    .choice.primary{border-color:rgba(56,189,248,.45)}
    .choice.green{border-color:rgba(34,197,94,.45)}
    .choice.red{border-color:rgba(239,68,68,.45)}

    .inputBar{
      padding:14px 16px;
      border-top:1px solid var(--border);
      display:flex;
      gap:10px;
      align-items:center;
    }
    input{
      flex:1;
      background:rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px 12px;
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    input::placeholder{color:rgba(148,163,184,.8)}
    button{
      border:0;
      border-radius:14px;
      padding:12px 14px;
      background:linear-gradient(135deg,#2563eb,#38bdf8);
      color:#fff;
      font-weight:950;
      cursor:pointer;
      transition:transform .08s ease, filter .2s ease;
    }
    button:hover{transform:translateY(-1px);filter:brightness(1.03)}
    button:disabled{opacity:.55;cursor:not-allowed;transform:none}

    /* Right panel (demo + info) */
    .demoBox{padding:16px}
    .demoTitle{font-weight:950;font-size:14px;margin-bottom:6px}
    .demoText{color:var(--muted);font-size:13px;line-height:1.45;margin-bottom:12px}
    .demoRow{display:flex;gap:10px;flex-wrap:wrap}
    .miniBtn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
    }
    .miniBtn:hover{filter:brightness(1.05)}
    .notice{
      margin-top:12px;
      padding:12px;
      border:1px solid var(--border);
      border-radius:14px;
      background:rgba(15,23,42,.35);
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .ok{color:#86efac;font-weight:900}
    .warn{color:#fde68a;font-weight:900}
  </style>
</head>
<body>
  <div class="shell">
    <div class="panel">
      <div class="head">
        <div class="brand">
          <div class="logo">PC</div>
          <div>
            Patient Concierge AI<br>
            <span style="color:var(--muted);font-size:12px;font-weight:700">Dental booking concierge</span>
          </div>
        </div>
        <div class="pill">‚óè Online</div>
      </div>
      <div class="subhead" id="subheadText">
        Answer a few quick questions and we‚Äôll send your request to the clinic.
      </div>

      <div class="chat" id="chat"></div>

      <div class="inputBar">
        <input id="textInput" placeholder="Type here‚Ä¶" />
        <button id="sendBtn">Send</button>
      </div>
    </div>

    <div class="panel">
      <div class="head">
        <div class="brand">
          <div class="logo" style="background:linear-gradient(135deg,#16a34a,#22c55e)">‚úì</div>
          <div>
            Demo mode<br>
            <span style="color:var(--muted);font-size:12px;font-weight:700">Send the lead to your email</span>
          </div>
        </div>
        <div class="pill">Demo</div>
      </div>

      <div class="demoBox">
        <div class="demoTitle">How the demo works</div>
        <div class="demoText">
          You enter your clinic email below, complete the chat, and we‚Äôll send you the lead summary instantly.
        </div>

        <div class="demoRow">
          <input id="demoEmail" placeholder="Clinic email (demo)" />
          <button id="demoStartBtn" style="background:linear-gradient(135deg,#7c3aed,#2563eb)">Start demo</button>
        </div>

        <div class="notice" id="noticeBox">
          <span class="warn">Tip:</span> Use demo to show dentists that the chatbot really sends the full details to their email.
        </div>
      </div>
    </div>
  </div>
    <script>
    // ================================
    // ‚úÖ CONFIG (YOUR GOOGLE SCRIPT URL)
    // ================================
    // This is your existing Apps Script web app URL (mailer)
    const MAILER_URL = "https://script.google.com/macros/s/AKfycbwobfSvAaRJi7XKOekFQf5a7uVDIFaYwdsFkHnEsn35sQNFWgsZQtzwqNJAaGNxRcEE/exec";

    // Demo mode enabled when user clicks "Start demo"
    let DEMO_MODE = false;

    // Conversation state (Option A: service + core details)
    const state = {
      clinicEmail: "",
      service: "",
      name: "",
      phone: "",
      email: "",
      preferredTime: "",
      notes: ""
    };

    // Simple services list (general dental booking)
    const SERVICES = [
      "General Checkup / Cleaning",
      "Tooth Pain / Emergency",
      "Braces / Invisalign",
      "Whitening",
      "Extraction",
      "Filling / Root Canal",
      "Implants",
      "Kids Dentistry",
      "Other"
    ];

    // DOM refs
    const chatEl = document.getElementById("chat");
    const textInput = document.getElementById("textInput");
    const sendBtn = document.getElementById("sendBtn");

    const demoEmailEl = document.getElementById("demoEmail");
    const demoStartBtn = document.getElementById("demoStartBtn");
    const noticeBox = document.getElementById("noticeBox");

    // Helpers
    function scrollToBottom(){
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function addMsg(text, who="bot"){
      const row = document.createElement("div");
      row.className = "row " + (who === "bot" ? "bot" : "you");

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (who === "bot" ? "bot" : "you");
      bubble.textContent = text;

      row.appendChild(bubble);
      chatEl.appendChild(row);
      scrollToBottom();
    }

    function addChoices(promptText, choices, opts={}){
      addMsg(promptText, "bot");

      const row = document.createElement("div");
      row.className = "row bot";

      const wrap = document.createElement("div");
      wrap.className = "bubble bot";
      wrap.style.background = "rgba(15,23,42,.25)";

      const choiceWrap = document.createElement("div");
      choiceWrap.className = "choices";

      choices.forEach((label) => {
        const btn = document.createElement("button");
        btn.className = "choice " + (opts.className || "");
        btn.textContent = label;
        btn.onclick = () => opts.onPick && opts.onPick(label);
        choiceWrap.appendChild(btn);
      });

      wrap.appendChild(choiceWrap);
      row.appendChild(wrap);
      chatEl.appendChild(row);
      scrollToBottom();
    }

    function normalizePhone(p){
      // Keep digits and + only
      return (p || "").replace(/[^\d+]/g, "");
    }

    function isValidEmail(e){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((e || "").trim());
    }

    // Chat steps
    let step = "welcome"; // welcome -> service -> name -> phone -> emailOpt -> prefTime -> notes -> confirm
          function startBot(){
      chatEl.innerHTML = "";
      step = "service";

      addMsg("Hi üëã I‚Äôm Patient Concierge AI. I‚Äôll help you request an appointment.", "bot");
      addMsg("What do you need help with today?", "bot");

      addChoices("Choose one:", SERVICES, {
        className: "primary",
        onPick: (service) => {
          state.service = service;
          addMsg(service, "you");
          askName();
        }
      });
    }

    function askName(){
      step = "name";
      addMsg("Great ‚úÖ What‚Äôs your full name?", "bot");
    }

    function askPhone(){
      step = "phone";
      addMsg("Thanks. What‚Äôs your phone number? (so the clinic can contact you)", "bot");
    }

    function askEmailOptional(){
      step = "emailOpt";
      addMsg("Email (optional): you can type it now or type 'skip'.", "bot");
    }

    function askPreferredTime(){
      step = "prefTime";
      addChoices("When should the clinic contact you?", [
        "Morning",
        "Afternoon",
        "Evening",
        "Anytime today"
      ], {
        className: "green",
        onPick: (t) => {
          state.preferredTime = t;
          addMsg(t, "you");
          askNotes();
        }
      });
    }

    function askNotes(){
      step = "notes";
      addMsg("Final question: briefly describe what you need (1 sentence is fine).", "bot");
    }

    function confirmAndSend(){
      step = "confirm";

      addMsg("Perfect ‚úÖ Here‚Äôs what we‚Äôll send to the clinic:", "bot");
      addMsg(
        "Service: " + state.service +
        "\nName: " + state.name +
        "\nPhone: " + state.phone +
        (state.email ? "\nEmail: " + state.email : "\nEmail: (not provided)") +
        "\nPreferred time: " + state.preferredTime +
        "\nNotes: " + state.notes,
        "bot"
      );

      addChoices("Send now?", ["Send request ‚úÖ", "Edit details"], {
        className: "primary",
        onPick: async (pick) => {
          addMsg(pick, "you");
          if (pick.includes("Send")) {
            await sendLead();
          } else {
            addMsg("No problem. Let‚Äôs restart the questions.", "bot");
            state.service = "";
            state.name = "";
            state.phone = "";
            state.email = "";
            state.preferredTime = "";
            state.notes = "";
            startBot();
          }
        }
      });
    }

    async function sendLead(){
      // payload to Google Apps Script
      const payload = {
        demoEmail: state.clinicEmail || "",
        mode: DEMO_MODE ? "DEMO" : "LIVE",
        service: state.service,
        patientName: state.name,
        patientPhone: state.phone,
        patientEmail: state.email,
        preferredTime: state.preferredTime,
        notes: state.notes,
        submittedAt: new Date().toISOString()
      };

      try{
        addMsg("Sending your request now‚Ä¶", "bot");

        await fetch(MAILER_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });

        addMsg("‚úÖ Done! Your request has been sent to the clinic.", "bot");

        if (DEMO_MODE && state.clinicEmail){
          addMsg("‚úÖ Demo email sent to: " + state.clinicEmail, "bot");
        }

        addMsg("If you have another request, refresh the page to start again.", "bot");
      } catch (e){
        addMsg("‚ö†Ô∏è Something went wrong sending the request. Please try again.", "bot");
        console.error(e);
      }
    }

    // Input handling
    function handleUserText(text){
      const t = (text || "").trim();

      if (!t) return;

      addMsg(t, "you");

      if (step === "name"){
        state.name = t;
        askPhone();
        return;
      }

      if (step === "phone"){
        state.phone = normalizePhone(t);
        askEmailOptional();
        return;
      }

      if (step === "emailOpt"){
        if (t.toLowerCase() === "skip"){
          state.email = "";
          askPreferredTime();
          return;
        }
        if (!isValidEmail(t)){
          addMsg("That email doesn‚Äôt look correct. Please type a valid email or type 'skip'.", "bot");
          return;
        }
        state.email = t;
        askPreferredTime();
        return;
      }

      if (step === "notes"){
        state.notes = t;
        confirmAndSend();
        return;
      }

      // Default fallback
      addMsg("Please use the buttons above, or refresh to restart.", "bot");
    }
          // Events
    sendBtn.addEventListener("click", () => {
      handleUserText(textInput.value);
      textInput.value = "";
      textInput.focus();
    });

    textInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        handleUserText(textInput.value);
        textInput.value = "";
      }
    });

    demoStartBtn.addEventListener("click", () => {
      const email = (demoEmailEl.value || "").trim();

      if (!isValidEmail(email)){
        noticeBox.innerHTML = "‚ö†Ô∏è Please enter a valid clinic email for demo mode.";
        return;
      }

      DEMO_MODE = true;
      state.clinicEmail = email;

      noticeBox.innerHTML = "<span class='ok'>‚úÖ Demo active:</span> leads will be emailed to <b>" + email + "</b>";
      startBot();
      textInput.focus();
    });

    // Auto-start normal chat if user isn't using demo
    // (They can still click Start demo anytime)
    addMsg("Welcome üëã To demo, enter your clinic email on the right and press 'Start demo'.", "bot");
    addMsg("Or you can continue normally and the clinic will receive your request.", "bot");
    addMsg("Click 'Start demo' to begin.", "bot");

  </script>
</body>
</html>
